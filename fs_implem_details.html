<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Implementation details &#8212; DFIR ORC  documentation</title>
    <link rel="stylesheet" href="_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /><link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'>
<link href="_static/solarized-dark.css" rel="stylesheet">
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        
        <li class="nav-item nav-item-0"><a href="index.html">DFIR ORC  documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.jpg" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">Requirements &amp; Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_to_data_collection.html">DFIR ORC Design and Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">DFIR ORC Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="tool_list.html">DFIR ORC Embedded Tool Suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="licenses.html">Licenses</a></li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="implementation-details">
<h1>Implementation details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h1>
<div class="section" id="supported-versions">
<h2>Supported Versions<a class="headerlink" href="#supported-versions" title="Permalink to this headline">¶</a></h2>
<p>File system related tools are entirely implemented in native C++, compiled with Visual Studio 2017 Update 9 and do not require any installation prior to execution on the currently supported Windows versions:</p>
<ul class="simple">
<li><p>Windows Workstation:</p>
<ul>
<li><p>Windows XP SP3 (Win32, x64)</p></li>
<li><p>Windows Vista SP1, SP2 (Win32, x64)</p></li>
<li><p>Windows 7 (Win32, x64)</p></li>
<li><p>Windows 8 (Win32, x64)</p></li>
<li><p>Windows 8.1 (Win32, x64)</p></li>
<li><p>Windows 10 (Win32, x64)</p></li>
</ul>
</li>
<li><p>Windows Server:</p>
<ul>
<li><p>Windows Server 2003 SP1, SP2 (Win32, x64)</p></li>
<li><p>Windows Server 2008 (Win32, x64)</p></li>
<li><p>Windows Server 2008 R2  (x64)</p></li>
<li><p>Windows Server 2012 (NTFS volumes) (x64)</p></li>
<li><p>Windows Server 2016 (NTFS volumes) (x64)</p></li>
<li><p>Windows Server 2019 (NTFS volumes) (x64)</p></li>
</ul>
</li>
</ul>
</div>
<div class="section" id="usn-parser-implementation-details">
<h2>USN Parser Implementation Details<a class="headerlink" href="#usn-parser-implementation-details" title="Permalink to this headline">¶</a></h2>
<p>The USN parser is based on a specific FSCTL called <a class="reference external" href="http://msdn.microsoft.com/en-us/library/aa364563(VS.85).aspx">FSCTL_ENUM_USN_DATA</a>.</p>
<p>FSCTL_ENUM_USN_DATA does not walk through the change journal.
It is a fallback path for when a change journal does not record all
the information requested by an app. This call walks through the MFT to identify files changed between two USN identifiers.
Since it is walking the MFT, it generates mostly sequential IO which can be a huge performance win.</p>
<p>If the identifiers specified are zero and MAXLONGLONG, this effectively walks through every file on the volume (whether USN is active or not.)</p>
<p>Incidentally, this is how defrag works on NTFS.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This is NTFS-specific. However, if a solution is required that works on other file systems, you’d need to implement multiple paths. Once we have enumerated the USN data, we enumerate each record returned. To gather information about a specific file, we have to obtain a handle to the file. Since malicious path encoding could limit our inspection (with like, reserved names), we use a special syntax of NtOpenFile() with the FILE_OPEN_BY_FILE_ID flag passing the USN_RECORD.FileReferenceNumber. This trick makes NTFSInfo’s USN parser resilient to path related ‘tricks’ (like using reserved names). However, we are still going through the Windows NTFS implementation so we are still dependent on file sharing status of the file and the DACL set on the file. The MFT parser does not suffer from this limitation.</p>
</div>
</div>
<div class="section" id="mft-parser-implementation-details">
<h2>MFT Parser Implementation Details<a class="headerlink" href="#mft-parser-implementation-details" title="Permalink to this headline">¶</a></h2>
<p>To obtain resiliency to strict ACL or sharing status of a file, we have implemented a Master file Table (MFT)
parser that allows us to directly open the volume itself (.C:) and  read disk geometry and information.
From here, we are able to locate the boot sector that provides information about the location of the $MFT
extents (or segments). From there, we are able to read the MFT, record by record.</p>
<p>Once this is done, we are able to parse the MFT records to read attributes like $FILE_NAME and $DATA attributes.
Using this data we can deduce all required information to compute NTFS meta data information.
One of the immediate benefits of using MFT parser is the ability of the tool to compute cryptographic
hashes of locked or secured (DACLed) files or being able to read the file contents.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        
        <li class="nav-item nav-item-0"><a href="index.html">DFIR ORC  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2019, ANSSI. The contents of this documentation is available under the Open License version 2.0 as published by Etalab (French task force for Open Data). The name DFIR ORC and the associated logo belong to ANSSI, no use is permitted without its express approval. Le contenu de cette documentation est disponible sous license Open License version 2.0 telle que publiée par Etalab (organisation francaise pour Open Data). Le nom DFIR ORC et le logo associé appartiennent à l&#39;ANSSI, tout usage doit être expressément autorisé par l&#39;ANSSI..
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.2.0.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
  </body>
</html>