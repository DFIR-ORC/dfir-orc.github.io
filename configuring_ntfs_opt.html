<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>Configuring ntfs_find/ntfs_exclude attributes &#8212; DFIR ORC  documentation</title>
    <link rel="stylesheet" href="_static/solar.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/css/custom.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /><link href='http://fonts.googleapis.com/css?family=Source+Code+Pro|Open+Sans:300italic,400italic,700italic,400,300,700' rel='stylesheet' type='text/css'>
<link href="_static/solarized-dark.css" rel="stylesheet">
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        
        <li class="nav-item nav-item-0"><a href="index.html">DFIR ORC  documentation</a> &#187;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/logo.jpg" alt="Logo"/>
            </a></p>
<h3><a href="index.html">Table of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="index.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="platforms.html">Requirements &amp; Supported Platforms</a></li>
<li class="toctree-l1"><a class="reference internal" href="intro_to_data_collection.html">DFIR ORC Design and Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">DFIR ORC Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="tool_list.html">DFIR ORC Embedded Tool Suite</a></li>
<li class="toctree-l1"><a class="reference internal" href="licenses.html">Licenses</a></li>
</ul>

        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="configuring-ntfs-find-ntfs-exclude-attributes">
<h1>Configuring ntfs_find/ntfs_exclude attributes<a class="headerlink" href="#configuring-ntfs-find-ntfs-exclude-attributes" title="Permalink to this headline">¶</a></h1>
<p>FastFind, RegInfo and GetThis can select file system entries based on multiple indicators to allow precise definition of what you may be looking for.
You can combine attributes of different class (file/hash/size/header/ads/ea/attribute) to specify an AND condition for this indicator. A Yara scan can also be used.
For instance:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ntfs_find</span> <span class="na">name=</span><span class="s">&quot;quickfix.dat&quot;</span> <span class="na">size=</span><span class="s">&quot;104857600&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Indicates the looked after file should be named « quickfix.dat » AND its size be 104857600 bytes to trigger a detection.</p>
<p>The table below describes the attributes that can be used to describe the indicators:</p>
<ul>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">name</span></code></dt><dd><p>File name compares to the supplied string</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;quickfix.dat&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">name_match</span></code></dt><dd><p>File name matches the supplied string</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name_match</span><span class="o">=</span><span class="s2">&quot;quick*.dat&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">name_regex</span></code></dt><dd><p>File name matches the regular expression</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name_regex</span><span class="o">=</span><span class="s2">&quot;quick.*\.dat&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">path</span></code></dt><dd><p>File full path compares to the supplied string</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;\Windows\System32\drivers\partmgr.sys&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">path_match</span></code></dt><dd><p>File full path matches the supplied string</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path_match</span><span class="o">=</span><span class="s2">&quot;\Windows\System32\*\partmgr.s?s&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">path_regex</span></code></dt><dd><p>File full path matches the regular expression</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path_regex</span><span class="o">=</span><span class="s2">&quot;\Windows\System32\.*\partmgr.s.?s&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">size</span></code></dt><dd><p>File size equals the supplied integer.
Multipliers can be use:
* 1K for 1024 bytes
* 1M for 1024 Kbytes
* 1G for 1024 Mbytes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">size</span><span class="o">=</span><span class="s2">&quot;5M&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">size_gt</span></code></dt><dd><p>File size is greater than the supplied integer</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">size_gt</span><span class="o">=</span><span class="s2">&quot;5M&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">size_ge</span></code></dt><dd><p>File size is greater or equal than the supplied integer</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">size_ge</span><span class="o">=</span><span class="s2">&quot;5M&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">size_lt</span></code></dt><dd><p>File size is less than the supplied integer</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">size_lt</span><span class="o">=</span><span class="s2">&quot;5M&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">size_le</span></code></dt><dd><p>File size is less or equal than the supplied integer</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">size_le</span><span class="o">=</span><span class="s2">&quot;5M&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">md5</span></code></dt><dd><p>File MD5 hash is the supplied value</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">md5</span><span class="o">=</span><span class="s2">&quot;b092e1d683fc21cea137dba2a8b4b08b&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">sha1</span></code></dt><dd><p>File SHA1 hash is the supplied value</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sha1</span><span class="o">=</span><span class="s2">&quot; be0ccf54cdb3ec100de233b393d936d2ee1c33a3 &quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">sha256</span></code></dt><dd><p>File SHA256 hash is the supplied value</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sha256</span><span class="o">=</span><span class="s2">&quot;4cdb3ec100de233b393d936d2ee1c33a3…&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">header</span></code></dt><dd><p>Header compares to the supplied string (ANSI encoding). Up to 128 bytes.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">header</span><span class="o">=</span><span class="s2">&quot;MZ&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">header_hex</span></code></dt><dd><p>Header compares to the supplied hex encoded bytes.
“0x” prefix can be used and is optional. Up to 128 bytes</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">header_hex</span><span class="o">=</span><span class="s2">&quot;ccf54cdb&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">header_regex</span></code></dt><dd><p>Header matches the regular expression.
Regex will be matched against header_len bytes from the file.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">header_regex</span><span class="o">=</span><span class="s2">&quot;M[X-Y]&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">header_length</span></code></dt><dd><p>Length of the header to read to do the comparison (in bytes).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">header_length</span><span class="o">=</span><span class="s2">&quot;1024&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">ads</span></code></dt><dd><p>ADS compares to the supplied string</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ads</span><span class="o">=</span><span class="s2">&quot;MyAds&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">ads_match</span></code></dt><dd><p>ADS matches the supplied string</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ads_match</span><span class="o">=</span><span class="s2">&quot;My?ds&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">ads_regex</span></code></dt><dd><p>ADS matches the regular expression</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ads_regex</span><span class="o">=</span><span class="s2">&quot;My.ds&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">ea</span></code></dt><dd><p>EA compares to the supplied string</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>ea=”MyEA”
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">ea_match</span></code></dt><dd><p>EA matches the supplied string</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ea_match</span><span class="o">=</span><span class="s2">&quot;My?A&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">ea_regex</span></code></dt><dd><p>EA matches the regular expression</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ea_regex</span><span class="o">=</span><span class="s2">&quot;My.A&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">attr_name</span></code></dt><dd><p>Attribute name compares to the supplied string</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attr_name</span><span class="o">=</span><span class="s2">&quot;$I30&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">attr_match</span></code></dt><dd><p>Attribute name matches the supplied string</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attr_match</span><span class="o">=</span><span class="s2">&quot;?I30&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">attr_regex</span></code></dt><dd><p>Attribute name matches the regular expression</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attr_regex</span><span class="o">=</span><span class="s2">&quot;.I30&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">attr_type</span></code></dt><dd><p>Attribute type is one of:</p>
<ul class="simple">
<li><p>$STANDARD_INFORMATION</p></li>
<li><p>$ATTRIBUTE_LIST</p></li>
<li><p>$FILE_NAME</p></li>
<li><p>$OBJECT_ID</p></li>
<li><p>$SECURITY_DESCRIPTOR</p></li>
<li><p>$VOLUME_NAME</p></li>
<li><p>$VOLUME_INFORMATION</p></li>
<li><p>$DATA</p></li>
<li><p>$INDEX_ROOT</p></li>
<li><p>$INDEX_ALLOCATION</p></li>
<li><p>$BITMAP</p></li>
<li><p>$REPARSE_POINT</p></li>
<li><p>$EA_INFORMATION</p></li>
<li><p>$EA</p></li>
<li><p>$LOGGED_UTILITY_STREAM</p></li>
<li><p>$FIRST_USER_DEFINED_ATTRIBUTE</p></li>
<li><p>$END</p></li>
<li><p>Or a custom integer value.</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">attr_type</span><span class="o">=</span><span class="s2">&quot;$STANDARD_INFORMATION&quot;</span>
<span class="n">attr_type</span><span class="o">=</span><span class="s2">&quot;16&quot;</span>
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">contains</span></code></dt><dd><p>All $DATA attributes are searched if their content contains a specific string (ASCII)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>contains=”Hello World”
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">contains_hex</span></code></dt><dd><p>All $DATA attributes are searched if their content contains a specific binary array</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>contains_hex=”0x0BADF00DBAADF000D”
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">yara</span></code></dt><dd><p>Specifies a yara “source” file from which rules can be used to match file’s content.
Can be either a file name or a reference to a embedded resource.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>yara=”res:#MyYaraFile”
</pre></div>
</div>
</dd>
</dl>
</li>
<li><dl>
<dt><code class="docutils literal notranslate"><span class="pre">yara_rule</span></code></dt><dd><p>Specifies a comma or semi-colon separated list of yara rule specification.
Rule specification may use * or ? to match arbitrary characters</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>yara_rule=”is_dll;apt??_rat”
</pre></div>
</div>
</dd>
</dl>
</li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Attributes evaluation order is based on cost. For instance, size is a very cheap indicator to evaluate. Hash value is very expensive. So the evaluator will first test file size and then (if size matches) will evaluate the file’s hash value. This means that coupling a size indicator to a hash one will dramatically enhance the performance of the search.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>At least one yara rule (matching the file’s content) should match at least one of the rules specification for the file match to succeed (i.e. if the file’s content matches arbitrary yara rules not mentioned in the yara_rule attribute, then the match will fail for this file. For a successful yara scan to always succeed, please use the yara_rule=”*” specification.</p>
</div>
<div class="section" id="ntfs-exclude">
<h2>ntfs_exclude<a class="headerlink" href="#ntfs-exclude" title="Permalink to this headline">¶</a></h2>
<p>ntfs_exclude elements can be used to exclude specific matches.
Once a match is found using a ntfs_find term, exclusion terms are evaluated.
When a match matches all attributes of an exclusion term, the complete match is excluded.
For instance, you could be interested in getting all explorer.exe files except the one located in Windowsexplorer.exe.
This would make:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ntfs_find</span> <span class="na">name=</span><span class="s">&quot;explorer.exe&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;ntfs_exclude</span> <span class="na">name=</span><span class="s">&quot;\Windows\explorer.exe&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Or, considering the Windows catalogs, while excluding known ones:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ntfs_find</span> <span class="na">path_match=</span><span class="s">&quot;\Windows\System32\catroot\*\*.cat&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;ntfs_exclude</span> <span class="na">size=</span><span class="s">&quot;138618&quot;</span> <span class="na">md5=</span><span class="s">&quot;d2182e5de2b13d2e68ee66d1bb44fe34&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All ntfs_find attributes are supported by ntfs_exclude <strong>except</strong> extended attributes related ones (ea, ea_match, ea_regex).</p>
</div>
</div>
<div class="section" id="ntfs-find-examples">
<h2>ntfs_find examples<a class="headerlink" href="#ntfs-find-examples" title="Permalink to this headline">¶</a></h2>
<p>To specify system’s registry hives, the FileFind element would be :</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ntfs_find</span> <span class="na">path=</span><span class="s">&quot;\Windows\System32\config\SOFTWARE&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;nffs_find</span> <span class="na">path=</span><span class="s">&quot;\Windows\System32\config\SYSTEM&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>To specify all user registry hives:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ntfs_find</span> <span class="na">path_match=</span><span class="s">&quot;\Users\*\NTUSER.DAT&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;ntfs_find</span> <span class="na">path_match=</span><span class="s">&quot;\Documents and Settings\*\NTUSER.DAT&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>To specify Internet Explorer temporary files:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ntfs_find</span> <span class="na">path_match=</span><span class="s">&quot;*\Temporary Internet Files\*&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
<p>To specify a file name quickfix.dat whose size is 104857600 and sha1 is 7894ec01651ff3fcdf9d117f416875bbaef03b6d:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;ntfs_find</span> <span class="na">name=</span><span class="s">&quot;quickfix.dat&quot;</span> <span class="na">size=</span><span class="s">&quot;104857600&quot;</span> <span class="na">sha1=</span><span class="s">&quot;7894ec01651ff3fcdf9d117f416875bbaef03b6d&quot;</span> <span class="nt">/&gt;</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        
        <li class="nav-item nav-item-0"><a href="index.html">DFIR ORC  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2019, ANSSI. The contents of this documentation is available under the Open License version 2.0 as published by Etalab (French task force for Open Data). The name DFIR ORC and the associated logo belong to ANSSI, no use is permitted without its express approval. Le contenu de cette documentation est disponible sous license Open License version 2.0 telle que publiée par Etalab (organisation francaise pour Open Data). Le nom DFIR ORC et le logo associé appartiennent à l&#39;ANSSI, tout usage doit être expressément autorisé par l&#39;ANSSI..
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 2.2.0.Theme is <a href="http://github.com/vimalkvn/solar-theme">Solar</a>
    </div>
  </body>
</html>